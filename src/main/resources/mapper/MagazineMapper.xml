<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.plantee.mapper.MagazineMapper">
	<select id="read" resultType="hashmap">
		select *
		from posts
		where post_id = #{post_id};
	</select>
	<select id="list" resultType="hashmap">
		select *
		from posts p, users u
		where p.user_id = u.user_id and category=7
		<if test="key=='title'">
			and title like concat('%',#{query},'%')
		</if>
		order by post_id desc
		limit #{start},#{size}
	</select>
    <select id="total" resultType="int">
    	select count(*)
    	from posts p,users u
    	where p.user_id = u.user_id and category=7
    	<if test="key=='title'">
			and title like concat('%',#{query},'%')
		</if>
		limit #{start}, ${size};
    </select>
	<insert id="insert">
		insert into posts(image, contents, category, title, user_id, nickname, uid)
		values(#{image}, #{contents}, #{category},#{title},#{user_id}, #{nickname}, #{uid});
	</insert>
	<update id="update">
		update posts
		set title = #{title}, image = #{image}, contents = #{contents}, uid=#{uid}
		where post_id = #{post_id}
	</update>
	<update id="readCount">
		update posts
		set view_cnt = view_cnt + 1
		where post_id =#{post_id} and category=7
	</update>
	<delete id="delete">
		delete from posts
		where post_id = #{post_id};
	</delete>
	<update id="image">
		update shop set image=#{image} where post_id=#{post_id}
	</update>
</mapper>